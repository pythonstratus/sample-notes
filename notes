try:
    # First define xml_file_path in the global scope
    xml_file_path = None
    
    # Get the XML file path
    found_files = glob.glob(os.path.join("/Volumes/staging/fpds_raw/landing/raw/2025/01", "fpds_output_*.xml"))
    print(f"Found XML files: {found_files}")  # Debug print
    
    if not found_files:
        raise ValueError("No XML files found")
    
    # Convert the list result to a single string path
    xml_file_path = str(max(found_files))
    print(f"Selected XML file path: {xml_file_path}")  # Debug print
    
    # Verify it's a string and not empty
    if not isinstance(xml_file_path, str) or not xml_file_path:
        raise ValueError(f"Invalid XML file path: {xml_file_path}")
    
    # Remove existing widgets
    dbutils.widgets.removeAll()
    
    # Create widgets with verified string values
    dbutils.widgets.text("file_path", xml_file_path)
    dbutils.widgets.text("table_name", "staging.fpds_raw.contract_data")
    dbutils.widgets.text("source_metadata_table_name", "staging.fpds_raw.source_metadata")
    
    # Get and print the filename for verification
    file_name = os.path.basename(xml_file_path)
    print(f"xml_file_path-->{xml_file_path}")
    print(f"file_name-->{file_name}")

except Exception as e:
    print(f"Error setting up widgets: {str(e)}")
    print(f"Type of xml_file_path: {type(xml_file_path) if 'xml_file_path' in locals() else 'Not defined'}")
    print(f"Value of xml_file_path: {xml_file_path if 'xml_file_path' in locals() else 'Not defined'}")
    raise
