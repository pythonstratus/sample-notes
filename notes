import os
from datetime import datetime
import glob

def get_latest_xml_file_path(base_path="/Volumes/staging/fpds_raw/landing/raw"):
    """
    Returns the path to the latest XML file in the specified directory structure.
    
    Args:
        base_path (str): Base directory path to search in
    
    Returns:
        str: Full path to the latest XML file found in the directory
    """
    # Get current year and month
    current_date = datetime.now()
    year_month = current_date.strftime('%Y/%m')
    
    # Construct the search path
    search_path = os.path.join(base_path, year_month)
    
    # Get list of all XML files in the directory
    xml_pattern = os.path.join(search_path, "fpds_output_*.xml")
    xml_files = glob.glob(xml_pattern)
    
    if not xml_files:
        return None
        
    # Get the latest file
    latest_file = max(xml_files)
    
    return latest_file

# Create widgets for parameterization
xml_file_path = get_latest_xml_file_path()
dbutils.widgets.text("file_path", xml_file_path)
dbutils.widgets.text("table_name", "staging.fpds_raw.contract_data")
dbutils.widgets.text("source_metadata_table_name", "staging.fpds_raw.source_metadata")
file_name = os.path.basename(dbutils.widgets.get("file_path"))
