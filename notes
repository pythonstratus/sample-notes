# COMMAND ----------
# Create or replace temp view with latest data
spark.sql("""
    CREATE OR REPLACE TEMPORARY VIEW latest_contract_data AS
    SELECT contract_data.*
    FROM staging.fpds_raw.contract_data AS contract_data
    INNER JOIN (
        SELECT max(contract_data_1.insert_date) AS max
        FROM staging.fpds_raw.contract_data contract_data_1
    ) latest_date
    ON contract_data.insert_date = latest_date.max
""")

# COMMAND ----------
# Write the data to fpds schema
spark.sql("""
    CREATE TABLE IF NOT EXISTS fpds.contract_data
    AS SELECT * FROM latest_contract_data
""")

# COMMAND ----------
# Set owner if needed
spark.sql("""
    ALTER TABLE IF EXISTS fpds.contract_data
    OWNER TO operational_dba
""")
