metadata_df.createOrReplaceTempView("updates")
spark.sql(f"""
    MERGE INTO {source_table_name} target
    USING updates source
    ON target.file_name = source.file_name
    WHEN MATCHED THEN UPDATE SET *
    WHEN NOT MATCHED THEN INSERT *
""")
