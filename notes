from pyspark.sql.functions import col, concat, coalesce, lit

contract_id = concat(
    # Agency ID (first 4 digits)
    col("ns0:content.ns1:award.ns1:awardID.ns1:awardContractID.ns1:agencyID._value"),
    
    # Transaction type and related identifiers
    col("ns0:content.ns1:award.ns1:awardID.ns1:awardContractID.ns1:PIID"),
    
    # F indicator and sequence
    lit("F"),
    col("ns0:content.ns1:award.ns1:awardID.ns1:referencedIDVID.ns1:PIID"),
    
    # P and mod number
    lit("P"),
    coalesce(col("ns0:content.ns1:award.ns1:awardID.ns1:awardContractID.ns1:modNumber"), lit("00001"))
).alias("contract_id")

# Add this to your selected fields
selected_fields = selected_fields + (contract_id,)
