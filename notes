try:
    # Get current year and month
    current_date = datetime.now()
    year_month = current_date.strftime('%Y/%m')
    
    # Construct the search path dynamically
    base_path = "/Volumes/staging/fpds_raw/landing/raw"
    search_path = os.path.join(base_path, year_month)
    
    print(f"Search path: {search_path}")  # Debug print
    
    # Find XML files
    found_files = glob.glob(os.path.join(search_path, "fpds_output_*.xml"))
    print(f"Found XML files: {found_files}")  # Debug print
    
    if not found_files:
        raise ValueError(f"No XML files found in path: {search_path}")
    
    # Sort files by modification time instead of using max()
    xml_file_path = str(sorted(found_files, key=os.path.getmtime)[-1])
    print(f"Selected most recent XML file: {xml_file_path}")  # Debug print
    
    # Verify it's a string and not empty
    if not isinstance(xml_file_path, str) or not xml_file_path:
        raise ValueError(f"Invalid XML file path: {xml_file_path}")
    
    # Remove existing widgets
    dbutils.widgets.removeAll()
    
    # Create widgets with verified string values
    dbutils.widgets.text("file_path", xml_file_path)
    dbutils.widgets.text("table_name", "staging.fpds_raw.contract_data")
    dbutils.widgets.text("source_metadata_table_name", "staging.fpds_raw.source_metadata")
    
    # Get and print the filename for verification
    file_name = os.path.basename(xml_file_path)
    print(f"xml_file_path-->{xml_file_path}")
    print(f"file_name-->{file_name}")

except Exception as e:
    print(f"Error setting up widgets: {str(e)}")
    print(f"Type of xml_file_path: {type(xml_file_path) if 'xml_file_path' in locals() else 'Not defined'}")
    print(f"Value of xml_file_path: {xml_file_path if 'xml_file_path' in locals() else 'Not defined'}")
    raise
