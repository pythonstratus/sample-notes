schema_name = "staging.bk_mpo_raw_test"  # Include the full schema name including 'staging'

# Step 1: Drop all tables
print("Step 1: Dropping tables...")
tables_df = spark.sql(f"SHOW TABLES IN {schema_name}")
for row in tables_df.collect():
    table_name = row.tableName
    print(f"Dropping table: {schema_name}.{table_name}")
    spark.sql(f"DROP TABLE IF EXISTS {schema_name}.{table_name}")

# Step 2: Drop all volumes
print("\nStep 2: Dropping volumes...")
volumes_df = spark.sql(f"SHOW VOLUMES IN {schema_name}")
for row in volumes_df.collect():
    db = row.database
    vol_name = row.volume_name
    print(f"Dropping volume: {db}.{vol_name}")
    spark.sql(f"DROP VOLUME IF EXISTS {db}.{vol_name}")

# Step 3: Drop the schema
print(f"\nStep 3: Dropping schema: {schema_name}")
spark.sql(f"DROP SCHEMA IF EXISTS {schema_name}")

print("Cleanup complete!")
