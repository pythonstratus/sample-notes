-- Validation Query with Null Checks
SELECT 
    "Validation" as name,
    prior_four_quarter_average,
    CASE 
        WHEN prior_four_quarter_average IS NULL THEN 'NULL'
        WHEN prior_four_quarter_average = 0 THEN 'ZERO'
        ELSE 'OTHER'
    END as prior_four_quarter_check,
    ratio_of_current_to_prior_4_avg,
    CASE 
        WHEN ratio_of_current_to_prior_4_avg IS NULL THEN 'NULL'
        WHEN ratio_of_current_to_prior_4_avg = 0 THEN 'ZERO'
        ELSE 'OTHER'
    END as ratio_check
FROM msis_mcr_val.line_item_data
WHERE filing_id = 16096731
    AND dimension_column = "Origination, Warehousing, and Secondary Marketing (1-4 Unit Residential Only)"
    AND line_item = "C340";

-- DMS Extract Query with Null Checks
SELECT 
    "DMS Extract" as name,
    prior_four_quarter_average,
    CASE 
        WHEN prior_four_quarter_average IS NULL THEN 'NULL'
        WHEN prior_four_quarter_average = 0 THEN 'ZERO'
        ELSE 'OTHER'
    END as prior_four_quarter_check,
    ratio_of_current_to_prior_4_avg,
    CASE 
        WHEN ratio_of_current_to_prior_4_avg IS NULL THEN 'NULL'
        WHEN ratio_of_current_to_prior_4_avg = 0 THEN 'ZERO'
        ELSE 'OTHER'
    END as ratio_check
FROM msis_mcr_dms.line_item_data
WHERE filing_id = 16096731
    AND dimension_column = "Origination, Warehousing, and Secondary Marketing (1-4 Unit Residential Only)"
    AND line_item = "C340";
